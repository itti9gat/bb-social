(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(5345)}])},5345:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return v}});var a=s(5893),n=s(7844),l=s(4848),o=s(3533),r=s(4053),i=s(7294),d=s(495);function u(e){let{onPost:t}=e,[s,n]=(0,i.useState)(null),[u,c]=(0,i.useState)(""),[h,p]=(0,i.useState)([]),[v,x]=(0,i.useState)(!1),f=(0,r.useSupabaseClient)(),m=(0,r.useSession)();(0,i.useEffect)(()=>{f.from("profiles").select().eq("id",m.user.id).then(e=>{e.data.length&&n(e.data[0])})},[]);let g=()=>{""!==u&&f.from("posts").insert({author:m.user.id,content:u,photos:h}).then(e=>{!e.error&&(c(""),p([]),t&&t())})},w=async e=>{let t=e.target.files;if(t.length>0){for(let e of(x(!0),t)){let t=Date.now()+e.name;await f.storage.from("photos").upload(t,e).then(e=>{if(e.data){let t="https://xcsvoeiuobfilsxfigvr.supabase.co/storage/v1/object/public/photos/"+e.data.path;p(e=>[...e,t])}})}x(!1)}};return(0,a.jsxs)(o.Z,{children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(l.Z,{url:null==s?void 0:s.avatar}),(0,a.jsx)("textarea",{value:u,onChange:e=>c(e.target.value),className:"grow p-2 border-gray-100 border-2 rounded-xl",placeholder:"What's on your mind ? ".concat(null==s?void 0:s.name)})]}),v&&(0,a.jsx)(d.Z,{}),h.length>0&&(0,a.jsx)("div",{className:"flex gap-2 py-3",children:h.map((e,t)=>(0,a.jsx)("div",{children:(0,a.jsx)("img",{className:"w-auto h-24 rounded-md",src:e,alt:""})},t))}),(0,a.jsxs)("div",{className:"flex justify-between py-3",children:[(0,a.jsxs)("label",{className:"flex gap-1 items-center px-2 cursor-pointer",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})}),"Photos",(0,a.jsx)("input",{type:"file",multiple:!0,className:"hidden",onChange:w})]}),(0,a.jsx)("button",{onClick:g,className:"bg-blue-500 px-5 py-1 text-white rounded-md",children:"Share"})]})]})}function c(){let e=(0,r.useSupabaseClient)(),t=async()=>{await e.auth.signInWithOAuth({provider:"google"})};return(0,a.jsx)("div",{className:"flex h-screen items-center",children:(0,a.jsx)("div",{className:"max-w-md mx-auto",children:(0,a.jsxs)("button",{onClick:t,className:"bg-white p-4 gap-3 items-center flex rounded-lg shadow-md cursor-pointer hover:bg-blue-500 hover:text-white",children:[(0,a.jsx)("svg",{className:"h-8 fill-current",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 488 512",children:(0,a.jsx)("path",{d:"M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"})}),"Login with  Google"]})})})}var h=s(1417),p=s(1403);function v(){var e;let t=(0,r.useSession)(),s=(0,r.useSupabaseClient)(),[l,o]=(0,i.useState)([]),[d,v]=(0,i.useState)(null),x=async()=>{await s.from("posts").select("id, content, author, photos, created_at, profiles(id, name, avatar)").order("created_at",{ascending:!1}).then(e=>{var t;(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.length)&&o(e.data)})},f=async()=>{var e;await s.from("profiles").select().eq("id",null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.id).then(e=>{var t;v(null===(t=e.data)||void 0===t?void 0:t[0])})};return((0,i.useEffect)(()=>{(null==t?void 0:t.user.id)&&(x(),f())},[null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.id]),t)?(0,a.jsx)(p.f,{children:(0,a.jsxs)(n.Z,{children:[(0,a.jsx)(u,{onPost:x}),l.map(e=>(0,a.jsx)(h.Z,{...e,myProfile:d},e.created_at))]})}):(0,a.jsx)(c,{})}}},function(e){e.O(0,[514,237,774,888,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);